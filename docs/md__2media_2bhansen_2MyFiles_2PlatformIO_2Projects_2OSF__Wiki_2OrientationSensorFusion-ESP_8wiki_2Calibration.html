<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Fusion Library: Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Sensor Fusion Library<span id="projectnumber">&#160;0.6.1</span>
   </div>
   <div id="projectbrief">Orientation sensing for Espressif (ESP32, ESP8266) processors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Calibration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md35"></a>There are two phases of calibration:</p><ol type="1">
<li>Initial Installation Calibration</li>
<li>In-use Calibration</li>
</ol>
<p><b>Installation Calibration</b> is a manual procedure performed once you have placed the orientation device at its final location. This procedure consists of manually rotating the sensor through as wide a variety of orientations as practical over a one or two minute period. The sensor will need to be hand-held for this, ideally very close to the final mounting location so the magnetic environment doesn't change after mounting. Use the parameters of calibration fit error <code>GetMagneticFitErrorTrial()</code> and calibration order <code>GetMagneticCalOrder()</code> reported by the sensor as an indication of when sufficient datapoints have accumulated for the calibration. Generally, a fit error of less than 3.5% at a calibration solver order of 10 is considered good.</p>
<p>Once the manual calibration is completed, save the calibration values to non-volatile memory via the appropriate call to the software. Then mount the sensor, power it up again, and test its performance while rotating the vessel through an entire 360 degrees. If the heading accuracy is acceptable, the initial installation calibration is done. If not, you need to redo the manual calibration. Check for and remove any magnetic materials (ferrous metals, electrical wires, speakers, compasses, etc) from the vicinity of the sensor.</p>
<p><b>In-use Calibration</b> is performed automatically by the software while in operation. On power-up, any saved calibration values are loaded and used immediately. Then, while running, the software periodically collects sets of magnetic datapoints and tries to generate a new calibration using those points. If the new calibration has an improved fit and order over the current in-use calibration, then the new calibration replaces the in-use one. This allows the sensor to compensate for transient changes in the magnetic environment while in use. Note that any newly-generated calibration is <em>not</em> saved to non-volatile memory unless commanded to do so via software. If you suspect the saved calibration is no longer optimum, (e.g. you have made changes to the nearby environment of the sensor), then it likely would be a good idea to perform a new manual calibration and save it.</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Calibration Algorithms</h1>
<p>Three levels, or complexity, of the calibration algorithm are used, depending on the number of datapoints available in the magnetic readings buffer. The current algorithm in use is indicated by <code>GetMagneticCalOrder()</code> as a number in the set [0,4,7,10]. 0 means no calibration solver has produced a solution yet. 10 means that a solution using the most sophisticated algorithm is available.</p><ol type="1">
<li>The <b>four element</b> solver determines the field strength and hard iron offsets vector. The inverse soft iron matrix is set to the identity matrix. This is the simplest solver.</li>
<li>The <b>seven element</b> solver adds non-unity diagonal elements to the inverse soft iron matrix. This model gives a significant improvement when either the magnetometer sensor has differing gains in its three channels or when the local environment has differing magnetic impedances along its three Cartesian axes.</li>
<li>The <b>ten element</b> solver adds off-diagonal non-zero elements to the inverse soft iron matrix. This model gives an improvement over the seven-parameter model when the local environmentâ€™s magnetic impedances steer the geomagnetic field in directions that are not aligned with the sensor's Cartesian axes giving a rotated magnetic ellipsoid.</li>
</ol>
<h1><a class="anchor" id="autotoc_md37"></a>
Further Information</h1>
<ul>
<li>NXP Application Note <b>AN5019</b> <em>Magnetic Calibration Algorithms</em> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 18 2026 09:42:29 for Sensor Fusion Library by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
