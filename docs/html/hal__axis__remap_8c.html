<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Fusion Library: src/sensor_fusion/hal_axis_remap.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sensor Fusion Library
   &#160;<span id="projectnumber">0.2.0</span>
   </div>
   <div id="projectbrief">Orientation sensing for Espressif (ESP32, ESP8266) processors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_6c27f870686619d49dbb46eee7e71f8b.html">sensor_fusion</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">hal_axis_remap.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Hardware Abstraction layer for the particular sensors used. Depending on the design of the sensor PCB, the axes of the sensor ICs are not necessarily oriented as assumed by the fusion algorithm. This file defines the axis remapping functions that are always applied to the raw data before processing.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="sensor__fusion_8h_source.html">sensor_fusion.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for hal_axis_remap.c:</div>
<div class="dyncontent">
<div class="center"><img src="hal__axis__remap_8c__incl.png" border="0" usemap="#src_2sensor__fusion_2hal__axis__remap_8c" alt=""/></div>
<map name="src_2sensor__fusion_2hal__axis__remap_8c" id="src_2sensor__fusion_2hal__axis__remap_8c">
<area shape="rect" title="Hardware Abstraction layer for the particular sensors used. Depending on the design of the sensor PCB..." alt="" coords="440,5,599,47"/>
<area shape="rect" href="sensor__fusion_8h.html" title="The sensor_fusion.h file implements the top level programming interface." alt="" coords="457,95,581,121"/>
<area shape="rect" title=" " alt="" coords="5,169,73,196"/>
<area shape="rect" title=" " alt="" coords="98,169,181,196"/>
<area shape="rect" title=" " alt="" coords="359,408,429,435"/>
<area shape="rect" title=" " alt="" coords="319,169,386,196"/>
<area shape="rect" href="board_8h.html" title="Board configuration file." alt="" coords="411,169,481,196"/>
<area shape="rect" href="driver__sensors__types_8h.html" title="The driver_sensors_types.h file contains sensor state structs and error definitions." alt="" coords="371,333,543,360"/>
<area shape="rect" href="build_8h.html" title="Build configuration file." alt="" coords="557,169,623,196"/>
<area shape="rect" href="magnetic_8h.html" title="Lower level magnetic calibration interface." alt="" coords="648,169,743,196"/>
<area shape="rect" href="matrix_8h.html" title="Matrix manipulation functions." alt="" coords="767,169,845,196"/>
<area shape="rect" href="orientation_8h.html" title="Functions to convert between various orientation representations." alt="" coords="869,169,975,196"/>
<area shape="rect" href="precisionAccelerometer_8h.html" title="Implements accelerometer calibration routines." alt="" coords="711,333,899,360"/>
<area shape="rect" href="driver__fxos8700_8h.html" title="Describes the fxos8700 driver interface and structures." alt="" coords="255,244,410,285"/>
<area shape="rect" href="driver__fxas21002_8h.html" title="Contains the fxas21002 sensor register definitions and its bit mask." alt="" coords="434,244,589,285"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afe116134dc1e5109171e81bab6c2afd8"><td class="memItemLeft" align="right" valign="top"><a id="afe116134dc1e5109171e81bab6c2afd8"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__axis__remap_8c.html#afe116134dc1e5109171e81bab6c2afd8">ApplyAccelHAL</a> (struct <a class="el" href="structAccelSensor.html">AccelSensor</a> *Accel)</td></tr>
<tr class="memdesc:afe116134dc1e5109171e81bab6c2afd8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the accelerometer Hardware Abstraction Layer. <br /></td></tr>
<tr class="separator:afe116134dc1e5109171e81bab6c2afd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706bba14747c3d73c6f2bb2e95b7d558"><td class="memItemLeft" align="right" valign="top"><a id="a706bba14747c3d73c6f2bb2e95b7d558"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__axis__remap_8c.html#a706bba14747c3d73c6f2bb2e95b7d558">ApplyMagHAL</a> (struct <a class="el" href="structMagSensor.html">MagSensor</a> *Mag)</td></tr>
<tr class="memdesc:a706bba14747c3d73c6f2bb2e95b7d558"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the magnetometer Hardware Abstraction Layer. <br /></td></tr>
<tr class="separator:a706bba14747c3d73c6f2bb2e95b7d558"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ef1a7ef89f75f9436eb6a121a1a1a66"><td class="memItemLeft" align="right" valign="top"><a id="a9ef1a7ef89f75f9436eb6a121a1a1a66"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hal__axis__remap_8c.html#a9ef1a7ef89f75f9436eb6a121a1a1a66">ApplyGyroHAL</a> (struct <a class="el" href="structGyroSensor.html">GyroSensor</a> *Gyro)</td></tr>
<tr class="memdesc:a9ef1a7ef89f75f9436eb6a121a1a1a66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the gyroscope Hardware Abstraction Layer. <br /></td></tr>
<tr class="separator:a9ef1a7ef89f75f9436eb6a121a1a1a66"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hardware Abstraction layer for the particular sensors used. Depending on the design of the sensor PCB, the axes of the sensor ICs are not necessarily oriented as assumed by the fusion algorithm. This file defines the axis remapping functions that are always applied to the raw data before processing. </p>
<p>With an unknown sensor board, the most straightforward way to determine the correct axis transformations is to use the Sensor Toolbox. Set the below transformations to your best guess (or start with no transformations). Load the software, launch the Toolbox, and then observe the orientation readouts while manipulating the board. Using the Digital Compass algorithm (which doesn't rely on accel or gyro), remap the axes as needed to get the Heading displaying correctly (i.e. near 0 degrees when your board is flat and pointing north, and the heading increases with clockwise rotation). Next adjust the accelerometer axes, using the Pitch and Roll readouts together with the Tilt-Compensated Compass algorithm. Finally, adjust the gyro axes by ensuring that rotations in all three axes give the expected response (i.e. that the magnetometer and accel are not 'fighting' the gyro, which causes the display to jerk around).</p>
<p>NXP Application Note AN5017 explains the coordinate systems used. NED (North-East-Down) also called Aerospace, is the most appropriate for marine use. It is oriented such that when X-axis points north, the Y-axis points east, and the Z-axis points down. The fusion algorithm uses a "gravity-positive" interpretation - i.e. it expects each accelerometer axis to read +1g when pointing down, and -1g when pointing up. This is reversed from most accelerometer ICs. Rotations are considered positive when they are Clockwise as viewed in the increasing positive direction along the axis. Magnetometer readings are considered positive when the earth's magnetic field (from S to N) points in the same direction as the axis (i.e. the increasing direction of the axis points north).</p>
<p>The present remapping is appropriate for the FXOS8700/FXAS21002C sensors on the Adafruit breakout board, with the NED coord system. Ax swapped with Ay. <br  />
 Mx swapped with My, then Mx,My,Mz inverted. <br  />
 Gx swapped with Gy, then Gx,Gy,Gz inverted. Checked 2020-11-13. Valid for NED: haven't checked other coord systems.</p>
<p>The present remapping is identical to the NXP FRDM-STBC-AGM01 breakout board using the FXOS8700/FXAS21002. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
