<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Fusion Library: src/sensor_fusion/sensor_fusion.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sensor Fusion Library
   &#160;<span id="projectnumber">0.4.0</span>
   </div>
   <div id="projectbrief">Orientation sensing for Espressif (ESP32, ESP8266) processors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_6c27f870686619d49dbb46eee7e71f8b.html">sensor_fusion</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sensor_fusion.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The <a class="el" href="sensor__fusion_8c.html" title="The sensor_fusion.c file implements the top level programming interface.">sensor_fusion.c</a> file implements the top level programming interface.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;<a class="el" href="sensor__fusion_8h_source.html">sensor_fusion.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fusion_8h_source.html">fusion.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hal__i2c_8h_source.html">hal_i2c.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hal__timer_8h_source.html">hal_timer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="status_8h_source.html">status.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sensor_fusion.c:</div>
<div class="dyncontent">
<div class="center"><img src="sensor__fusion_8c__incl.png" border="0" usemap="#src_2sensor__fusion_2sensor__fusion_8c" alt=""/></div>
<map name="src_2sensor__fusion_2sensor__fusion_8c" id="src_2sensor__fusion_2sensor__fusion_8c">
<area shape="rect" title="The sensor_fusion.c file implements the top level programming interface." alt="" coords="615,5,798,47"/>
<area shape="rect" title=" " alt="" coords="5,244,72,271"/>
<area shape="rect" href="sensor__fusion_8h.html" title="The sensor_fusion.h file implements the top level programming interface." alt="" coords="490,169,614,196"/>
<area shape="rect" href="control_8h.html" title="Defines control sub&#45;system." alt="" coords="566,95,645,121"/>
<area shape="rect" href="fusion_8h.html" title="Lower level sensor fusion interface." alt="" coords="669,95,744,121"/>
<area shape="rect" href="hal__i2c_8h.html" title="The hal_i2c.h file declares low&#45;level interface functions for reading and writing sensor registers us..." alt="" coords="1073,169,1153,196"/>
<area shape="rect" href="hal__timer_8h.html" title="Wrapper for Hardware Abstraction Layer (HAL) Contains replacements for hardware&#45;specific functions Cu..." alt="" coords="819,95,915,121"/>
<area shape="rect" href="status_8h.html" title="Application&#45;specific status subsystem." alt="" coords="939,95,1013,121"/>
<area shape="rect" title=" " alt="" coords="590,244,658,271"/>
<area shape="rect" title=" " alt="" coords="1033,244,1116,271"/>
<area shape="rect" title=" " alt="" coords="921,483,991,509"/>
<area shape="rect" href="board_8h.html" title="Board configuration file." alt="" coords="763,244,834,271"/>
<area shape="rect" href="driver__sensors__types_8h.html" title="The driver_sensors_types.h file contains sensor state structs and error definitions." alt="" coords="994,408,1166,435"/>
<area shape="rect" href="build_8h.html" title="Build configuration file." alt="" coords="96,244,163,271"/>
<area shape="rect" href="magnetic_8h.html" title="Lower level magnetic calibration interface." alt="" coords="187,244,282,271"/>
<area shape="rect" href="matrix_8h.html" title="Matrix manipulation functions." alt="" coords="307,244,384,271"/>
<area shape="rect" href="orientation_8h.html" title="Functions to convert between various orientation representations." alt="" coords="409,244,514,271"/>
<area shape="rect" href="precisionAccelerometer_8h.html" title="Implements accelerometer calibration routines." alt="" coords="458,408,646,435"/>
<area shape="rect" href="driver__fxos8700_8h.html" title="Describes the fxos8700 driver interface and structures." alt="" coords="900,319,1055,360"/>
<area shape="rect" href="driver__fxas21002_8h.html" title="Contains the fxas21002 sensor register definitions and its bit mask." alt="" coords="721,319,876,360"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a741fd2193cc58c09b692d1ae2b7a81e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a741fd2193cc58c09b692d1ae2b7a81e8">setStatus</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg, <a class="el" href="sensor__fusion_8h.html#a69ee883e1c22b117df163c0bd83f66dd">fusion_status_t</a> status)</td></tr>
<tr class="separator:a741fd2193cc58c09b692d1ae2b7a81e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6be6cce5ced2ae430ab26d458d0619bb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sensor__fusion_8h.html#a69ee883e1c22b117df163c0bd83f66dd">fusion_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a6be6cce5ced2ae430ab26d458d0619bb">getStatus</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:a6be6cce5ced2ae430ab26d458d0619bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae96e36747e6a1aabbec1381f15132ec6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#ae96e36747e6a1aabbec1381f15132ec6">queueStatus</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg, <a class="el" href="sensor__fusion_8h.html#a69ee883e1c22b117df163c0bd83f66dd">fusion_status_t</a> status)</td></tr>
<tr class="separator:ae96e36747e6a1aabbec1381f15132ec6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa13c4a9f07f3a2abfdb2e0808e5752d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#aa13c4a9f07f3a2abfdb2e0808e5752d4">updateStatus</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:aa13c4a9f07f3a2abfdb2e0808e5752d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a142a0a30c123f8acf79a3e8e5072cad8"><td class="memItemLeft" align="right" valign="top"><a id="a142a0a30c123f8acf79a3e8e5072cad8"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>testStatus</b> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:a142a0a30c123f8acf79a3e8e5072cad8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43b44018042fabb5179c2e62277cc942"><td class="memItemLeft" align="right" valign="top"><a id="a43b44018042fabb5179c2e62277cc942"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a43b44018042fabb5179c2e62277cc942">initSensorFusionGlobals</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg, <a class="el" href="structStatusSubsystem.html">StatusSubsystem</a> *pStatusSubsystem, <a class="el" href="structControlSubsystem.html">ControlSubsystem</a> *pControlSubsystem)</td></tr>
<tr class="memdesc:a43b44018042fabb5179c2e62277cc942"><td class="mdescLeft">&#160;</td><td class="mdescRight">utility function to insert default values in the top level structure <br /></td></tr>
<tr class="separator:a43b44018042fabb5179c2e62277cc942"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c9c520415ab2e14bb28e2530d2cad54"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a9c9c520415ab2e14bb28e2530d2cad54">installSensor</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg, struct <a class="el" href="structPhysicalSensor.html">PhysicalSensor</a> *pSensor, uint16_t addr, uint16_t schedule, <a class="el" href="structregisterDeviceInfo__t.html">registerDeviceInfo_t</a> *busInfo, initializeSensor_t *initialize, readSensor_t *read)</td></tr>
<tr class="separator:a9c9c520415ab2e14bb28e2530d2cad54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae748e1330b5a94783c6d4ea2ad9e4f28"><td class="memItemLeft" align="right" valign="top"><a id="ae748e1330b5a94783c6d4ea2ad9e4f28"></a>
int8_t&#160;</td><td class="memItemRight" valign="bottom"><b>initializeSensors</b> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:ae748e1330b5a94783c6d4ea2ad9e4f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf8b47198fa614f0b50265addf44a8b0"><td class="memItemLeft" align="right" valign="top"><a id="aaf8b47198fa614f0b50265addf44a8b0"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>processMagData</b> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:aaf8b47198fa614f0b50265addf44a8b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aef17e3b5cdf8265e189bdee3b4e3e9"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a2aef17e3b5cdf8265e189bdee3b4e3e9">readSensors</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg, uint8_t read_loop_counter)</td></tr>
<tr class="separator:a2aef17e3b5cdf8265e189bdee3b4e3e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef2b1f23f820d2b513bc827f8baffd0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#aef2b1f23f820d2b513bc827f8baffd0d">conditionSensorReadings</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:aef2b1f23f820d2b513bc827f8baffd0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac57932c39d665755aeee1e62fac763e3"><td class="memItemLeft" align="right" valign="top"><a id="ac57932c39d665755aeee1e62fac763e3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>zeroArray</b> (<a class="el" href="structStatusSubsystem.html">StatusSubsystem</a> *pStatus, void *data, uint16_t size, uint16_t numElements, uint8_t check)</td></tr>
<tr class="separator:ac57932c39d665755aeee1e62fac763e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9af8710b3e87acd2a33e7988b2d75b6c"><td class="memItemLeft" align="right" valign="top"><a id="a9af8710b3e87acd2a33e7988b2d75b6c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a9af8710b3e87acd2a33e7988b2d75b6c">clearFIFOs</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="memdesc:a9af8710b3e87acd2a33e7988b2d75b6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to clear FIFO at the end of each fusion computation. <br /></td></tr>
<tr class="separator:a9af8710b3e87acd2a33e7988b2d75b6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b90119fee979d0309cc923bf1fad543"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a8b90119fee979d0309cc923bf1fad543">runFusion</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg)</td></tr>
<tr class="separator:a8b90119fee979d0309cc923bf1fad543"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad806fd4e0528fbcc42a46697fdb53394"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#ad806fd4e0528fbcc42a46697fdb53394">initializeFusionEngine</a> (<a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *sfg, int pin_i2c_sda, int pin_i2c_scl)</td></tr>
<tr class="separator:ad806fd4e0528fbcc42a46697fdb53394"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2686eeb8ae44e588362478db1f757a0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#a2686eeb8ae44e588362478db1f757a0e">conditionSample</a> (int16_t sample[3])</td></tr>
<tr class="memdesc:a2686eeb8ae44e588362478db1f757a0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">conditionSample ensures that we never encounter the maximum negative two's complement value for a 16-bit variable (-32768).  <a href="sensor__fusion_8c.html#a2686eeb8ae44e588362478db1f757a0e">More...</a><br /></td></tr>
<tr class="separator:a2686eeb8ae44e588362478db1f757a0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7d2343e9a63bd3879ae477ec4536f6a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__fusion_8c.html#ae7d2343e9a63bd3879ae477ec4536f6a">addToFifo</a> (union <a class="el" href="unionFifoSensor.html">FifoSensor</a> *sensor, uint16_t maxFifoSize, int16_t sample[3])</td></tr>
<tr class="memdesc:ae7d2343e9a63bd3879ae477ec4536f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">addToFifo is called from within sensor driver read functions  <a href="sensor__fusion_8c.html#ae7d2343e9a63bd3879ae477ec4536f6a">More...</a><br /></td></tr>
<tr class="separator:ae7d2343e9a63bd3879ae477ec4536f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The <a class="el" href="sensor__fusion_8c.html" title="The sensor_fusion.c file implements the top level programming interface.">sensor_fusion.c</a> file implements the top level programming interface. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ae7d2343e9a63bd3879ae477ec4536f6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7d2343e9a63bd3879ae477ec4536f6a">&#9670;&nbsp;</a></span>addToFifo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addToFifo </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionFifoSensor.html">FifoSensor</a> *&#160;</td>
          <td class="paramname"><em>sensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>maxFifoSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>sample</em>[3]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>addToFifo is called from within sensor driver read functions </p>
<p>addToFifo is called from within sensor driver read functions to transfer new readings into the sensor structure corresponding to accel, gyro or mag. This function ensures that the software FIFOs are not overrun.</p>
<p>example usage: if (status==SENSOR_ERROR_NONE) addToFifo((FifoSensor*) &amp;(sfg-&gt;Mag), MAG_FIFO_SIZE, sample); </p>

</div>
</div>
<a id="a2686eeb8ae44e588362478db1f757a0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2686eeb8ae44e588362478db1f757a0e">&#9670;&nbsp;</a></span>conditionSample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void conditionSample </td>
          <td>(</td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>sample</em>[3]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>conditionSample ensures that we never encounter the maximum negative two's complement value for a 16-bit variable (-32768). </p>
<p>conditionSample ensures that we never encounter the maximum negative two's complement value for a 16-bit variable (-32768). This value cannot be negated, because the maximum positive value is +32767. We need the ability to negate to gaurantee that subsequent HAL operations can be run successfully. </p>

</div>
</div>
<a id="aef2b1f23f820d2b513bc827f8baffd0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef2b1f23f820d2b513bc827f8baffd0d">&#9670;&nbsp;</a></span>conditionSensorReadings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void conditionSensorReadings </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="sensor__fusion_8c.html#aef2b1f23f820d2b513bc827f8baffd0d">conditionSensorReadings()</a> transforms raw software FIFO readings into forms that can be consumed by the sensor fusion engine. This include sample averaging and (in the case of the gyro) integrations, applying hardware abstraction layers, and calibration functions. This function is normally invoked via the "sfg." global pointer. </p>

</div>
</div>
<a id="a6be6cce5ced2ae430ab26d458d0619bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6be6cce5ced2ae430ab26d458d0619bb">&#9670;&nbsp;</a></span>getStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sensor__fusion_8h.html#a69ee883e1c22b117df163c0bd83f66dd">fusion_status_t</a> getStatus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Poor man's inheritance for status subsystem getStatus command This function is normally invoked via the "sfg." global pointer. </p>

</div>
</div>
<a id="ad806fd4e0528fbcc42a46697fdb53394"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad806fd4e0528fbcc42a46697fdb53394">&#9670;&nbsp;</a></span>initializeFusionEngine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initializeFusionEngine </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pin_i2c_sda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pin_i2c_scl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is responsible for initializing the system prior to starting the main fusion loop. I2C is initted, sensors configured, calibrations loaded. This function is normally invoked via the "sfg." global pointer. Fusion system status is set to: INITIALIZING at the start of this function, HARD_FAULT if a problem occurs initializing the I2C hardware, SOFT_FAULT if a sensor doesn't initialize (it could be corrected later), NORMAL when function ends, assuming no problem occurred </p>

</div>
</div>
<a id="a9c9c520415ab2e14bb28e2530d2cad54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c9c520415ab2e14bb28e2530d2cad54">&#9670;&nbsp;</a></span>installSensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t installSensor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structPhysicalSensor.html">PhysicalSensor</a> *&#160;</td>
          <td class="paramname"><em>pSensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>schedule</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structregisterDeviceInfo__t.html">registerDeviceInfo_t</a> *&#160;</td>
          <td class="paramname"><em>busInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">initializeSensor_t *&#160;</td>
          <td class="paramname"><em>initialize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">readSensor_t *&#160;</td>
          <td class="paramname"><em>read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>installSensor is used to instantiate a physical sensor driver into the sensor fusion system. It doesn't actually communicate with the sensor. This function is normally invoked via the "sfg." global pointer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sfg</td><td>top level fusion structure </td></tr>
    <tr><td class="paramname">pSensor</td><td>pointer to structure describing physical sensor </td></tr>
    <tr><td class="paramname">addr</td><td>I2C address for sensor (if applicable) </td></tr>
    <tr><td class="paramname">schedule</td><td>Sensor is read each time loop_count % schedule == 0 </td></tr>
    <tr><td class="paramname">busInfo</td><td>information required for bus power management </td></tr>
    <tr><td class="paramname">initialize</td><td>pointer to sensor initialization function </td></tr>
    <tr><td class="paramname">read</td><td>pointer to sensor read function </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae96e36747e6a1aabbec1381f15132ec6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae96e36747e6a1aabbec1381f15132ec6">&#9670;&nbsp;</a></span>queueStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void queueStatus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sensor__fusion_8h.html#a69ee883e1c22b117df163c0bd83f66dd">fusion_status_t</a>&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Poor man's inheritance for status subsystem queueStatus command. This function is normally involved via the "sfg." global pointer. </p>

</div>
</div>
<a id="a2aef17e3b5cdf8265e189bdee3b4e3e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2aef17e3b5cdf8265e189bdee3b4e3e9">&#9670;&nbsp;</a></span>readSensors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t readSensors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>read_loop_counter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>readSensors traverses the linked list of physical sensors, calling the individual read functions one by one. This function is normally invoked via the "sfg." global pointer. If a sensor is flagged as uninitialized, an attempt is made to initialize it. If a sensor does not respond, it is marked as unintialized. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sfg</td><td>pointer to global sensor fusion data structure </td></tr>
    <tr><td class="paramname">read_loop_counter</td><td>current loop counter (used for multirate processing) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8b90119fee979d0309cc923bf1fad543"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b90119fee979d0309cc923bf1fad543">&#9670;&nbsp;</a></span>runFusion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void runFusion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>runFusion the top level call that actually runs the sensor fusion. This is a utility function which manages the various defines in <a class="el" href="build_8h.html" title="Build configuration file.">build.h</a>. You should feel free to drop down a level and implement only those portions of fFuseSensors() that your application needs. This function is normally involved via the "sfg." global pointer. </p>

</div>
</div>
<a id="a741fd2193cc58c09b692d1ae2b7a81e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a741fd2193cc58c09b692d1ae2b7a81e8">&#9670;&nbsp;</a></span>setStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setStatus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sensor__fusion_8h.html#a69ee883e1c22b117df163c0bd83f66dd">fusion_status_t</a>&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Poor man's inheritance for status subsystem setStatus command This function is normally invoked via the "sfg." global pointer. </p>

</div>
</div>
<a id="aa13c4a9f07f3a2abfdb2e0808e5752d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa13c4a9f07f3a2abfdb2e0808e5752d4">&#9670;&nbsp;</a></span>updateStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void updateStatus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSensorFusionGlobals.html">SensorFusionGlobals</a> *&#160;</td>
          <td class="paramname"><em>sfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Poor man's inheritance for status subsystem updateStatus command. This function is normally involved via the "sfg." global pointer. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
