<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Fusion Library: Accuracy, Repeatability, and Linearity</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Sensor Fusion Library<span id="projectnumber">&#160;0.6.1</span>
   </div>
   <div id="projectbrief">Orientation sensing for Espressif (ESP32, ESP8266) processors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Accuracy, Repeatability, and Linearity</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md27"></a> For use as an electronic compass, feeding data to instruments such as a radar, an accuracy on the order of +/- 2 degrees seems acceptable. Returning to the same heading at a later time should produce the same reading, within +/- 2 degrees. Heading readings over a full 360-degree rotation should vary linearly and be within about +/- 2 degrees of the actual heading.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Test Method - Linearity</h1>
<p>Place the sensor on a rotating test fixture. Step the test fixture through a full 360-degree rotation, pausing at known positions (corresponding to the spokes on the test fixture) to record the measured heading. Calculate the differences between headings, which is the measured step size, and compare them to the actual step size of 11.25 degrees.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Results - Linearity</h1>
<p>The measured steps were generally within 2 degrees of the actual step size. The deviation varies approximately sinusoidally over the full 360 degrees, suggesting that a large component of the error is systematic rather than random. A plot follows: <img src="./images/2020-11-26_Linearity.png?raw=true" alt="Linearity over 360 degrees" title="Deviation from Expected Heading During 11.25 Degree Steps" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md30"></a>
Test Method - Accuracy</h1>
<p>Place the sensor on a rotating test fixture. Point the sensor's X-axis at a geographical feature and record the sensor's reading. Rotate the fixture in both directions, stopping with the sensor pointed at the same feature and record the reading again. Repeat several times. For this test I chose a visually easy-to-locate feature seen from outside my house: the Mt Work summit, approx 11 km distance, at magnetic bearing 311.7 degrees according to GoogleMaps, and measured as 311.0 +/- 1 degrees with hand-bearing compass.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Results - Accuracy</h1>
<p>The first trial was unsuccessful. The heading was not close to what was expected, and varied widely over a 10 minute period. See the following graph. I speculate that this was caused by not calibrating the magnetic sensor for the new outside test location. Even after several rotations and manipulations, the reported reading still wandered. <img src="./images/2020-11-28_AbsoluteAccuracy3.png?raw=true" alt="Accuracy - Wandering" title="Wandering Heading while pointed in known direction" class="inline"/></p>
<p>A following trial was successful. Prior to this trial, I ran the Sensor Fusion Toolbox software, performed a magnetic calibration of the sensor while at the test location, and saved the calibration to non-volatile storage. On starting the test firmware, the median heading was within 0.7 degrees of what was expected, ranging about +/- 1.5 degrees around that value over a 20 minute period and with interspersed rotations followed by repointing the sensor at the geographical reference. See the following graph. <img src="./images/2020-11-28_AbsoluteAccuracy4.png?raw=true" alt="Accuracy" title="Stable Heading while pointed in known direction" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md32"></a>
Discussion - Accuracy</h1>
<p>I had initially believed the wandering heading to be due to the temperature change in moving from indoors (approx 17 C) to outdoors (approx 6 C), however even after 10 minutes outside the heading during the initial test had not stabilized. Checking with the Toolbox software showed that Magnetic Interference was detected (i.e. calibration was unsuited to the location), so the sensor was recalibrated and retested successfully. I do not know why it was insufficient to simply move the sensor around in order to calibrate it (as was tried in the first attempt); instead it functioned only after saving the new calibration to NVM. The actual calibration values were indeed quite different: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Date   </th><th class="markdownTableHeadNone">Hard Iron V[x]   </th><th class="markdownTableHeadNone">V[y]   </th><th class="markdownTableHeadNone">V[z]    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">13 Nov 2020   </td><td class="markdownTableBodyNone">14.90   </td><td class="markdownTableBodyNone">-17.30   </td><td class="markdownTableBodyNone">-45.50    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">28 Nov 2020   </td><td class="markdownTableBodyNone">-13.30   </td><td class="markdownTableBodyNone">-48.90   </td><td class="markdownTableBodyNone">-44.20   </td></tr>
</table>
<p>Further testing of this is needed. This also suggests that several functions should be added to the fusion code wrapper: one to indicate when magnetic interference is detected; and one to save a new magnetic calibration. It might also be useful to add a function to read the FXOS8700 temperature register, as it is uncertain to what extent the cooler outside temperature contributed to the need to recalibrate.</p>
<p>Once performing well, the absolute accuracy of the sensor was quite satisfactory. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 18 2026 09:42:29 for Sensor Fusion Library by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
