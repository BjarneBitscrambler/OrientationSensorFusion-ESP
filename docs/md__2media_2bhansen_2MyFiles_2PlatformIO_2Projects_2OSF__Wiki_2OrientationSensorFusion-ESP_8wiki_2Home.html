<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Fusion Library: Orientation Sensor wiki</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Sensor Fusion Library<span id="projectnumber">&#160;0.6.1</span>
   </div>
   <div id="projectbrief">Orientation sensing for Espressif (ESP32, ESP8266) processors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Orientation Sensor wiki</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md38"></a> Here's a collection of test plans, results, thoughts, and discussion relating to the performance of the FXOS8700/FXAS21002 combination orientation sensor. Select sub-pages for more details on each topic.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Work-In-Progress</h1>
<ul>
<li>[X] real-life use aboard S/V Hoku Pa'a, ongoing since 2020</li>
<li>[ ] port to other 9-DoF orientation sensors</li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
Sensor Fusion Algorithm</h1>
<p>The Fusion algorithm is central to the performance of the sensor. A great resource for background info is reference 6 (NXP User Guide to their Sensor Fusion Library) below.</p>
<p>The SensESP orientation sensor uses the Adafruit AHRS code, which is derived from <a href="https://github.com/memsindustrygroup/Open-Source-Sensor-Fusion/">https://github.com/memsindustrygroup/Open-Source-Sensor-Fusion/</a> This location has lots of info, including that it is based on Freescale's version 4.2.2 Sensor Fusion library. NXP now has version 7.20 released, which includes improved calibration features and faster CPU performance apparently. This project is my port of version 7.20 to the ESP32. It now displays data on NXP's <b>Sensor Fusion Toolbox</b> Windows app (reference 8 below). An interface class has now also been created that works with the SensESP project, and a PR is place to make this more permanent.</p>
<p>The Toolbox was very useful in developing and debugging orientation sensors (which shouldn't be surprising, as that's what it was intended to do ;-) The Toolbox doesn't perform any of the sensor fusion itself (that's all run on the ESP or other microprocessor) but rather displays the results of the various algorithms graphically. It also shows calibration results and the amount of magnetic interference being sensed.</p>
<p>While going through the exercise of porting the fusion code, these major improvements over version 4.2 have stuck out:</p><ul>
<li>v 7.20 supports sensor hardware's internal FIFOs. The default configuration runs the ICs at sampling rates of 400 Hz, and has the ESP32 poll the buffered data at 40 Hz. Sampling faster improves the signal to noise ratio of the processed data.</li>
<li>many internal parameters and intermediate results of the fusion algorithms are stored in a structure that is easily accessed. In fact, most of the contents of this struct are sent to the Fusion Toolbox application, where they can easily be seen and some can be adjusted.</li>
<li>magnetic calibration runs in parallel with the fusion algorithm, so one can monitor the magnetic environment of the sensor while in use and adjust the calibration if necessary.</li>
</ul>
<h1><a class="anchor" id="autotoc_md41"></a>
[[Performance and Testing sub-page|Parameters Tested]]</h1>
<h1><a class="anchor" id="autotoc_md42"></a>
[[Apparatus and Setup sub-page|Apparatus and Setup]]</h1>
<h1><a class="anchor" id="autotoc_md43"></a>
[[Magnetic Calibration sub-page|Magnetic Calibration]]</h1>
<h1><a class="anchor" id="autotoc_md44"></a>
Resources</h1>
<ol type="1">
<li><a href="https://github.com/SignalK/signalk-imu">https://github.com/SignalK/signalk-imu</a></li>
<li><a href="https://www.tindie.com/products/onehorse/ultimate-sensor-fusion-solution-mpu9250/">https://www.tindie.com/products/onehorse/ultimate-sensor-fusion-solution-mpu9250/</a></li>
<li>kriswiner's Github repositories, including: <a href="https://github.com/kriswiner/EM7180_SENtral_sensor_hub/wiki/K.-Limits-of-Absolute-Heading-Accuracy-Using-Inexpensive-MEMS-Sensors">https://github.com/kriswiner/EM7180_SENtral_sensor_hub/wiki/K.-Limits-of-Absolute-Heading-Accuracy-Using-Inexpensive-MEMS-Sensors</a> and <a href="https://github.com/kriswiner/MPU6050/wiki/Affordable-9-DoF-Sensor-Fusion">https://github.com/kriswiner/MPU6050/wiki/Affordable-9-DoF-Sensor-Fusion</a></li>
<li><a href="https://www.diva-portal.org/smash/get/diva2:648760/FULLTEXT01.pdf">Estimation of heading using magnetometer and GPS</a></li>
<li><a href="http://downloads.hindawi.com/journals/js/2015/435062.pdf">Performance Improvement of Inertial Navigation System by Using Magnetometer with Vehicle Dynamic Constraints</a></li>
<li><a href="https://www.nxp.com/docs/en/user-guide/NSFK_Prod_UG.pdf">NXP User Guide to Sensor Fusion Library</a></li>
<li><a href="https://www.nxp.com/docs/en/data-sheet/NSFK_DS.pdf">NXP Sensor Fusion Library Datasheet for Kinetis MCUs</a></li>
<li><a href="https://www.nxp.com/webapp/sps/download/license.jsp?colCode=SENSORFUSIONREV7">NXP Sensor Fusion Toolbox for Windows</a></li>
<li><a href="https://www.nxp.com/docs/en/application-note/AN5017.pdf">NXP Application Note AN5017 - Coordinate Systems</a> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Feb 18 2026 09:42:29 for Sensor Fusion Library by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
